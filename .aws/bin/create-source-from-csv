#!/bin/sh

REGION_AWS_CONFIG="us-west-2"
FILE_DL_AWS_CREDENTIALS="${HOME}/Downloads/credentials.csv"

if [ -e ${FILE_DL_AWS_CREDENTIALS} ]; then

  # シェルスクリプト用認証ファイルの作成

  AWS_USER_NAME=`
    cat ${FILE_DL_AWS_CREDENTIALS} |\
    grep -v ^User |\
    awk 'BEGIN{FS=","}{print $1}' |\
    sed 's/\"//g'` \
    && echo "username: ${AWS_USER_NAME}"

  cat ${FILE_DL_AWS_CREDENTIALS} |\
    grep -v ^User |\
    awk 'BEGIN{FS=","}{print "aws_access_key_id=" $2 "\naws_secret_access_key=" $3}' |\
    tr -d '\r' \
    > ~/.aws/source/${AWS_USER_NAME}.rc \
    && cat ~/.aws/source/${AWS_USER_NAME}.rc

  # 設定ファイルの作成

  FILE_USER_CONFIG="${HOME}/.aws/source/${AWS_USER_NAME}.config"

  echo "[profile ${AWS_USER_NAME}]" > ${FILE_USER_CONFIG} \
    && echo "region=${REGION_AWS_CONFIG}" >> ${FILE_USER_CONFIG} \
    && echo "" >> ${FILE_USER_CONFIG} \
    && cat ${FILE_USER_CONFIG}

  export AWS_DEFAULT_PROFILE=${AWS_USER_NAME}
fi
